<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0">
    <channel>
        <title>Pythonista</title>
        <link>http://127.0.0.1/blog/html/</link>
        <description>Blogging for Pythonistas</description>
        <language>en-us</language>
        <pubDate>Wed, 20 Jun 2018 00:00:00 +0530</pubDate>
        
        <item>
            <link>http://127.0.0.1/blog/html/2018/06/20/random.html</link>
            <guid>http://127.0.0.1/blog/html/2018/06/20/random.html</guid>
            <title><![CDATA[Python’s random module :  Real-valued distributions]]></title>
            <description><![CDATA[<h1>Python’s random module :  Real-valued distributions</h1>
<img alt="../../../_images/random_numbers.jpg" src="http://127.0.0.1/blog/html/_images/random_numbers.jpg"/>
<p>Hello Pythonistas , In my opinion the better to understand distributions is to visualize them.</p>
<div class="section" id="uniform-distrubution">
<h2>Uniform Distrubution</h2>
<p>Lets say , you would like to create random numbers between <strong>2000 and 3000</strong> such that the generated
values are uniformly distributed over the range. Here we are creating 1000 values over the range.
Histogram is really useful tool to bucketize a given set of values into given buckets.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span/><span class="n">mport</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="n">rom</span> <span class="n">random</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">opulation_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">uniform</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">3000</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)]</span>

<span class="n">lt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">population_data</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s2">"bar"</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">lt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Uniform distribution"</span><span class="p">)</span>
<span class="n">lt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../../../_images/uniform.png" src="http://127.0.0.1/blog/html/_images/uniform.png"/>
</div>
<div class="section" id="triangular-distribution">
<h2>Triangular Distribution</h2>
<p>Lets say , you would like to create random numbers between <strong>2000 and 3000</strong> such that the generated
values are triangularly distributed over the range. What i mean by Triangulary distributed is;
mid point between 2000 and 3000 is 2500. so more values will generated around this midpoint rather than
towards both the ends of range like less values towards 2000 and less values towards 3000.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span/><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="k">import</span> <span class="o">*</span>

<span class="n">population_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">triangular</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">3000</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">population_data</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s2">"bar"</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Triangular distribution"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../../../_images/gauss.png" src="http://127.0.0.1/blog/html/_images/gauss.png"/>
</div>
<div class="section" id="gaussian-distribution">
<h2>Gaussian Distribution</h2>
<p>Sometimes when you wish to tightly control the values generated around midpoint.
In gaussian distribution you specify the mean and the max variation thats allowed from mean. [ Standard Deviation ]</p>
<p>In this example we generate values such that the mean is 2500 and allowed variation from mean is 15.
If you carefully look at the output and compare it to Triangular distribution , you will see that density of values around
mean is way higher than its seen with Triangular distribution.</p>
<p>In fact all the values are between 2460 to 2540</p>
<div class="code python highlight-default"><div class="highlight"><pre><span/><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="k">import</span> <span class="o">*</span>

<span class="n">population_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">gauss</span><span class="p">(</span><span class="mi">2500</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">population_data</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s2">"bar"</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Gaussian distribution"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../../../_images/traingle.png" src="http://127.0.0.1/blog/html/_images/traingle.png"/>
</div>
<div class="section" id="expovariate-distribution">
<h2>Expovariate Distribution</h2>
<p>This is also another useful distribution where you would like to simulate</p>
<ol class="arabic simple">
<li>arrival times of customer</li>
<li>arrival of network packets</li>
</ol>
<p>for example when you go to bank , you can see that customers arrive randomly.
sometimes they come in a bunch, but every once a in while there is no one.</p>
<p>Same thing hanppens with network packets , they come in a bunch and sometimes there is
no network traffic.</p>
<p>average_arrival_interval = 5.6</p>
<div class="code python highlight-default"><div class="highlight"><pre><span/><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="k">import</span> <span class="o">*</span>

<span class="n">population_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">expovariate</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mf">5.6</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">population_data</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s2">"bar"</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Expovariate distribution"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../../../_images/expo.png" src="http://127.0.0.1/blog/html/_images/expo.png"/>
<p>Now if you are thinking where you would use these distributions, Random module has a great section on example and Recipe’s
<a class="reference external" href="https://docs.python.org/3/library/random.html#examples-and-recipes">Example</a></p>
</div>
<div class="section" id="simulation-of-arrival-times-and-service-deliveries-in-a-single-server-queue">
<h2>Simulation of arrival times and service deliveries in a single server queue:</h2>
<div class="code python highlight-default"><div class="highlight"><pre><span/><span class="kn">from</span> <span class="nn">random</span> <span class="k">import</span> <span class="n">expovariate</span><span class="p">,</span> <span class="n">gauss</span>
<span class="kn">from</span> <span class="nn">statistics</span> <span class="k">import</span> <span class="n">mean</span><span class="p">,</span> <span class="n">median</span><span class="p">,</span> <span class="n">stdev</span>

<span class="n">average_arrival_interval</span> <span class="o">=</span> <span class="mf">5.6</span>
<span class="n">average_service_time</span> <span class="o">=</span> <span class="mf">5.0</span>
<span class="n">stdev_service_time</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="n">num_waiting</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">arrivals</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">starts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">arrival</span> <span class="o">=</span> <span class="n">service_end</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20000</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">arrival</span> <span class="o">&lt;=</span> <span class="n">service_end</span><span class="p">:</span>
        <span class="n">num_waiting</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># see how expovariate is used to simulate arrival times</span>
        <span class="n">arrival</span> <span class="o">+=</span> <span class="n">expovariate</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">average_arrival_interval</span><span class="p">)</span>
        <span class="n">arrivals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arrival</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">num_waiting</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">service_start</span> <span class="o">=</span> <span class="n">service_end</span> <span class="k">if</span> <span class="n">num_waiting</span> <span class="k">else</span> <span class="n">arrival</span>
        <span class="c1"># see how gaussian is used to get the average service time by allowing margin</span>
        <span class="c1"># for variability in servicing requests.</span>
        <span class="n">service_time</span> <span class="o">=</span> <span class="n">gauss</span><span class="p">(</span><span class="n">average_service_time</span><span class="p">,</span> <span class="n">stdev_service_time</span><span class="p">)</span>
        <span class="n">service_end</span> <span class="o">=</span> <span class="n">service_start</span> <span class="o">+</span> <span class="n">service_time</span>
        <span class="n">starts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">service_start</span><span class="p">)</span>

<span class="n">waits</span> <span class="o">=</span> <span class="p">[</span><span class="n">start</span> <span class="o">-</span> <span class="n">arrival</span> <span class="k">for</span> <span class="n">arrival</span><span class="p">,</span> <span class="n">start</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">arrivals</span><span class="p">,</span> <span class="n">starts</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">'Mean wait: {mean(waits):.1f}.  Stdev wait: {stdev(waits):.1f}.'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">'Median wait: {median(waits):.1f}.  Max wait: {max(waits):.1f}.'</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="bonus-dont-miss-the-see-also-section">
<h2>Bonus - Dont miss the See Also section</h2>
<p>See also <a class="reference external" href="https://www.youtube.com/watch?v=Iq9DzN6mvYA">Statistics for Hackers</a> a video tutorial by <a class="reference external" href="https://us.pycon.org/2016/speaker/profile/295/">Jake Vanderplas</a> on statistical analysis using just a few fundamental concepts including simulation, sampling, shuffling, and cross-validation.</p>
<p><a class="reference external" href="http://nbviewer.jupyter.org/url/norvig.com/ipython/Economics.ipynb">Economics Simulation</a> a simulation of a marketplace by <a class="reference external" href="http://norvig.com/bio.html">Peter Norvig</a> that shows effective use of many of the tools and distributions provided by this module (gauss, uniform, sample, betavariate, choice, triangular, and randrange).</p>
<p><a class="reference external" href="http://nbviewer.jupyter.org/url/norvig.com/ipython/Probability.ipynb">A Concrete Introduction to Probability</a> (using Python) a tutorial by <a class="reference external" href="http://norvig.com/bio.html">Peter Norvig</a> covering the basics of probability theory, how to write simulations, and how to perform data analysis using Python.</p>
</div>
]]></description>
            <category><![CDATA[ programming ]]></category>
             <pubDate>Wed, 20 Jun 2018 00:00:00 +0530</pubDate>
        </item>
    
        <item>
            <link>http://127.0.0.1/blog/html/2018/06/13/tftp.html</link>
            <guid>http://127.0.0.1/blog/html/2018/06/13/tftp.html</guid>
            <title><![CDATA[Understanding TFTP protocol and write TFTP client in Python]]></title>
            <description><![CDATA[<div class="section" id="understanding-tftp-protocol-and-write-tftp-client-in-python">
<h1>Understanding TFTP protocol and write TFTP client in Python</h1>
<img alt="../../../_images/tftp-proto.jpg" src="http://127.0.0.1/blog/html/_images/tftp-proto.jpg"/>
<p>Hello Pythonistas, TFTP [ Trivial File Transfer Protocol ] is a light weight file transfer protocol,
there is really not much to it as seen in the above picture. Its a UDP [ User datagram protocol ] protocol.
There are connection oriented and connectionless protocols and TFTP falls under the later category.</p>
<p>Without getting into too much of technical details , lets see how the protocol plays in action.
On my mac i have set up TFTP server and there is builtin tftp client</p>
<div class="highlight-bash"><div class="highlight"><pre><span/>env  OSX  …/CLIENT  tftp
tftp&gt; ?
Commands may be abbreviated.  Commands are:

connect         connect to remote tftp
mode            <span class="nb">set</span> file transfer mode
put             send file
get             receive file
quit            <span class="nb">exit</span> tftp
verbose         toggle verbose mode
blksize         <span class="nb">set</span> an alternative blocksize <span class="o">(</span>def. <span class="m">512</span><span class="o">)</span>
tsize           toggle extended tsize option
trace           toggle packet tracing
status          show current status
binary          <span class="nb">set</span> mode to octet
ascii           <span class="nb">set</span> mode to netascii
rexmt           <span class="nb">set</span> per-packet retransmission timeout
timeout         <span class="nb">set</span> total retransmission timeout
tout            toggle extended timeout option
?               print <span class="nb">help</span> information
tftp&gt; connect localhost
tftp&gt; trace
Packet tracing on.
tftp&gt; status
Connected to localhost.
Mode: netascii Verbose: off Tracing: on
Rexmt-interval: <span class="m">5</span> seconds, Max-timeout: <span class="m">25</span> seconds


tftp&gt; get test.txt test.txt
sent RRQ &lt;<span class="nv">file</span><span class="o">=</span>test.txt, <span class="nv">mode</span><span class="o">=</span>netascii&gt;
received DATA &lt;<span class="nv">block</span><span class="o">=</span><span class="m">1</span>, <span class="m">512</span> bytes&gt;
sent ACK &lt;<span class="nv">block</span><span class="o">=</span><span class="m">1</span>&gt;
received DATA &lt;<span class="nv">block</span><span class="o">=</span><span class="m">2</span>, <span class="m">64</span> bytes&gt;
Received <span class="m">576</span> bytes in <span class="m">0</span>.0 seconds
</pre></div>
</div>
</div>
<div class="section" id="protocol-in-action-summary">
<h1>Protocol in action summary:</h1>
<p>As shown above the protocol can be seen in action on the last 6 lines or so.</p>
<ol class="arabic simple">
<li>Client sends a Read Request specifying a file and mode. [ We can see opcodes for that in RFC ]</li>
<li>Server responds with block of data along with block number.</li>
<li>Client sends an ACK for the received block</li>
<li>Server sends next data with incremented block number and ……</li>
</ol>
<dl class="docutils">
<dt><strong>Normal Termination</strong> - This excerpt is taken directly from <a class="reference external" href="https://tools.ietf.org/html/rfc1350/">RFC 1350</a></dt>
<dd><p class="first">The end of a transfer is marked by a DATA packet that contains
between 0 and 511 bytes of data (i.e., Datagram length &lt; 516).  This
packet is acknowledged by an ACK packet like all other DATA packets.
The host acknowledging the final DATA packet may terminate its side
of the connection on sending the final ACK.</p>
<blockquote class="last">
<div><table border="1" class="docutils">
<colgroup>
<col width="26%"/>
<col width="74%"/>
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Opcode</th>
<th class="head">Operation</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>Read request (RRQ)</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>Write request (WRQ)</td>
</tr>
<tr class="row-even"><td>3</td>
<td>Data (DATA)</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>Acknowledgment (ACK)</td>
</tr>
<tr class="row-even"><td>5</td>
<td>Error (ERROR)</td>
</tr>
</tbody>
</table>
</div></blockquote>
</dd>
</dl>
</div>
<div class="section" id="how-to-start-tftp-server-on-mac">
<h1>How to start TFTP server on Mac ?</h1>
<div class="highlight-bash"><div class="highlight"><pre><span/>sudo launchctl load -F /System/Library/LaunchDaemons/tftp.plist
sudo launchctl start com.apple.tftpd
</pre></div>
</div>
<p><strong>The directory that serves files is /private/tftpboot.</strong></p>
<p>To stop the TFTP server, either reboot or use this command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span/>sudo launchctl unload -F /System/Library/LaunchDaemons/tftp.plist
</pre></div>
</div>
<p>Now lets look at the command line interface of the application that we wish to create</p>
<div class="highlight-bash"><div class="highlight"><pre><span/>tftp-client  OSX  …/tftp-client   python tftp-client.py -h
tftp-client.
Usage:
  tftp-client.py get &lt;filename&gt; <span class="o">[[</span>-s <span class="p">|</span> -b <span class="o">]</span> --mode<span class="o">=</span>&lt;mode&gt;<span class="o">]</span>
  tftp-client.py <span class="o">(</span>-h <span class="p">|</span> --help<span class="o">)</span>

Options:
  -h --help     Show this screen.
  -s            Use python struct to build request.
  -b            Use python bytearray to build request.
  --mode<span class="o">=</span>&lt;mode&gt; TFTP transfer mode : <span class="s2">"netascii"</span>, <span class="s2">"octet"</span>, or <span class="s2">"mail"</span>
</pre></div>
</div>
<p>Once we know the interface, lets see how we can code it.</p>
</div>
<div class="section" id="algorithm">
<h1>Algorithm:</h1>
<ol class="arabic simple">
<li>Get the server and port information</li>
<li>Get the mode information [ Set default to netascii ]</li>
<li>Send the Read Request</li>
<li>Go in a while loop and read the data that server sends</li>
<li>If server sends error -&gt; Quit</li>
<li>If server sends proper data packet , send ack for each packet.</li>
<li>If the length of the received data is less than 516 -&gt; This is the last packet; so Quit.</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre><span/><span class="sd">"""tftp-client.</span>
<span class="sd">Usage:</span>
<span class="sd">  tftp-client.py get &lt;filename&gt; [[-s | -b ] --mode=&lt;mode&gt;]</span>
<span class="sd">  tftp-client.py (-h | --help)</span>

<span class="sd">Options:</span>
<span class="sd">  -h --help     Show this screen.</span>
<span class="sd">  -s            Use python struct to build request.</span>
<span class="sd">  -b            Use python bytearray to build request.</span>
<span class="sd">  --mode=&lt;mode&gt; TFTP transfer mode : "netascii", "octet", or "mail"</span>
<span class="sd">"""</span>

<span class="kn">from</span> <span class="nn">docopt</span> <span class="kn">import</span> <span class="n">docopt</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">from</span> <span class="nn">struct</span> <span class="kn">import</span> <span class="n">pack</span>

<span class="sd">"""</span>
<span class="sd">    opcode  operation</span>
<span class="sd">     1     Read request (RRQ)</span>
<span class="sd">     2     Write request (WRQ)</span>
<span class="sd">     3     Data (DATA)</span>
<span class="sd">     4     Acknowledgment (ACK)</span>
<span class="sd">     5     Error (ERROR)</span>

<span class="sd">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>

<span class="sd">      2 bytes     string    1 byte     string   1 byte</span>
<span class="sd">     ------------------------------------------------</span>
<span class="sd">    | Opcode |  Filename  |   0  |    Mode    |   0  |</span>
<span class="sd">     ------------------------------------------------</span>

<span class="sd">    Figure 5-1: RRQ/WRQ packet</span>

<span class="sd">   The [[ Mode ]] field contains the</span>

<span class="sd">   string "netascii", "octet", or "mail" (or any combination of upper</span>
<span class="sd">   and lower case, such as "NETASCII", NetAscii", etc.)</span>


<span class="sd">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>

<span class="sd">      2 bytes     2 bytes</span>
<span class="sd">     ---------------------</span>
<span class="sd">    | Opcode |   Block #  |</span>
<span class="sd">     ---------------------</span>

<span class="sd">     Figure 5-3: ACK packet</span>

<span class="sd">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>

<span class="sd">      2 bytes     2 bytes      n bytes</span>
<span class="sd">     ----------------------------------</span>
<span class="sd">    | Opcode |   Block #  |   Data     |</span>
<span class="sd">     ----------------------------------</span>

<span class="sd">     Figure 5-2: DATA packet</span>
<span class="sd">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>

<span class="sd">TFTP Formats</span>

<span class="sd">   Type   Op #     Format without header</span>

<span class="sd">          2 bytes    string   1 byte     string   1 byte</span>
<span class="sd">          -----------------------------------------------</span>
<span class="sd">   RRQ/  | 01/02 |  Filename  |   0  |    Mode    |   0  |</span>
<span class="sd">   WRQ    -----------------------------------------------</span>


<span class="sd">          2 bytes    2 bytes       n bytes</span>
<span class="sd">          ---------------------------------</span>
<span class="sd">   DATA  | 03    |   Block #  |    Data    |</span>
<span class="sd">          ---------------------------------</span>


<span class="sd">          2 bytes    2 bytes</span>
<span class="sd">          -------------------</span>
<span class="sd">   ACK   | 04    |   Block #  |</span>
<span class="sd">          --------------------</span>


<span class="sd">          2 bytes  2 bytes        string    1 byte</span>
<span class="sd">          ----------------------------------------</span>
<span class="sd">   ERROR | 05    |  ErrorCode |   ErrMsg   |   0  |</span>
<span class="sd">          ----------------------------------------</span>

<span class="sd">Error Codes</span>

<span class="sd">   Value     Meaning</span>

<span class="sd">   0         Not defined, see error message (if any).</span>
<span class="sd">   1         File not found.</span>
<span class="sd">   2         Access violation.</span>
<span class="sd">   3         Disk full or allocation exceeded.</span>
<span class="sd">   4         Illegal TFTP operation.</span>
<span class="sd">   5         Unknown transfer ID.</span>
<span class="sd">   6         File already exists.</span>
<span class="sd">   7         No such user.</span>

<span class="sd">====================</span>
<span class="sd">Protocol in action</span>
<span class="sd">====================</span>

<span class="sd">As shown above the protocol can be seen in action on the last 6 lines or so.</span>

<span class="sd">1. Client sends a Read Request specifying a file and mode. [ We can see opcodes for that in RFC ]</span>
<span class="sd">2. Server responds with block of data along with block number.</span>
<span class="sd">3. Client sends an ACK for the received block</span>
<span class="sd">4. Server sends next data with incremented block number and ......</span>

<span class="sd">** Normal Termination ** - This excerpt is taken directly from `RFC 1350 &lt;https://tools.ietf.org/html/rfc1350/&gt;`_</span>
<span class="sd">  The end of a transfer is marked by a DATA packet that contains</span>
<span class="sd">  between 0 and 511 bytes of data (i.e., Datagram length &lt; 516).  This</span>
<span class="sd">  packet is acknowledged by an ACK packet like all other DATA packets.</span>
<span class="sd">  The host acknowledging the final DATA packet may terminate its side</span>
<span class="sd">  of the connection on sending the final ACK.</span>

<span class="sd">"""</span>
<span class="n">TERMINATING_DATA_LENGTH</span> <span class="o">=</span> <span class="mi">516</span>
<span class="n">TFTP_TRANSFER_MODE</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">'netascii'</span>

<span class="n">TFTP_OPCODES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'unknown'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s1">'read'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># RRQ</span>
    <span class="s1">'write'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>  <span class="c1"># WRQ</span>
    <span class="s1">'data'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>  <span class="c1"># DATA</span>
    <span class="s1">'ack'</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>  <span class="c1"># ACKNOWLEDGMENT</span>
    <span class="s1">'error'</span><span class="p">:</span> <span class="mi">5</span><span class="p">}</span>  <span class="c1"># ERROR</span>

<span class="n">TFTP_MODES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'unknown'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s1">'netascii'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">'octet'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s1">'mail'</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>

<span class="c1"># Create a UDP socket</span>
<span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_DGRAM</span><span class="p">)</span>
<span class="n">server_address</span> <span class="o">=</span> <span class="p">(</span><span class="s1">'localhost'</span><span class="p">,</span> <span class="mi">69</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">send_rq</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    This function constructs the request packet in the format below.</span>
<span class="sd">    Demonstrates how we can construct a packet using bytearray.</span>

<span class="sd">        Type   Op #     Format without header</span>

<span class="sd">               2 bytes    string   1 byte     string   1 byte</span>
<span class="sd">               -----------------------------------------------</span>
<span class="sd">        RRQ/  | 01/02 |  Filename  |   0  |    Mode    |   0  |</span>
<span class="sd">        WRQ    -----------------------------------------------</span>


<span class="sd">    :param filename:</span>
<span class="sd">    :return:</span>
<span class="sd">    """</span>
    <span class="n">request</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
    <span class="c1"># First two bytes opcode - for read request</span>
    <span class="n">request</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">request</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># append the filename you are interested in</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">filename</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">))</span>
    <span class="n">request</span> <span class="o">+=</span> <span class="n">filename</span>
    <span class="c1"># append the null terminator</span>
    <span class="n">request</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># append the mode of transfer</span>
    <span class="n">form</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="s1">'utf-8'</span><span class="p">))</span>
    <span class="n">request</span> <span class="o">+=</span> <span class="n">form</span>
    <span class="c1"># append the last byte</span>
    <span class="n">request</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"Request {request}"</span><span class="p">)</span>
    <span class="n">sent</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">sendto</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">server_address</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">send_rq_struct</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    This function constructs the request packet in the format below</span>
<span class="sd">    Demonstrates how we can construct a packet using struct.</span>

<span class="sd">        Type   Op #     Format without header</span>
<span class="sd">               2 bytes    string   1 byte     string   1 byte</span>
<span class="sd">               -----------------------------------------------</span>
<span class="sd">        RRQ/  | 01/02 |  Filename  |   0  |    Mode    |   0  |</span>
<span class="sd">        WRQ    -----------------------------------------------</span>

<span class="sd">        :param filename:</span>
<span class="sd">        :return:</span>
<span class="sd">    """</span>
    <span class="n">formatter</span> <span class="o">=</span> <span class="s1">'&gt;h{}sB{}sB'</span>  <span class="c1"># { &gt; - Big Endian, h - short , s - char, B - 1 byte }</span>
    <span class="n">formatter</span> <span class="o">=</span> <span class="n">formatter</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="s1">'netascii'</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>  <span class="c1"># final format '&gt;h8sB8sB'</span>
    <span class="n">request</span> <span class="o">=</span> <span class="n">pack</span><span class="p">(</span><span class="n">formatter</span><span class="p">,</span> <span class="n">TFTP_OPCODES</span><span class="p">[</span><span class="s1">'read'</span><span class="p">],</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">'utf-8'</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="s1">'utf-8'</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"Request {request}"</span><span class="p">)</span>
    <span class="n">sent</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">sendto</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">server_address</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">send_ack</span><span class="p">(</span><span class="n">ack_data</span><span class="p">,</span> <span class="n">server</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    This function constructs the ack using the bytearray.</span>
<span class="sd">    We dont change the block number cause when server sends data it already has</span>
<span class="sd">    block number in it.</span>

<span class="sd">              2 bytes    2 bytes</span>
<span class="sd">             -------------------</span>
<span class="sd">      ACK   | 04    |   Block #  |</span>
<span class="sd">             --------------------</span>
<span class="sd">    :param ack_data:</span>
<span class="sd">    :param server:</span>
<span class="sd">    :return:</span>
<span class="sd">    """</span>
    <span class="n">ack</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">ack_data</span><span class="p">)</span>
    <span class="n">ack</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ack</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">TFTP_OPCODES</span><span class="p">[</span><span class="s1">'ack'</span><span class="p">]</span>
    <span class="k">print</span><span class="p">(</span><span class="n">ack</span><span class="p">)</span>
    <span class="n">sock</span><span class="o">.</span><span class="n">sendto</span><span class="p">(</span><span class="n">ack</span><span class="p">,</span> <span class="n">server</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">server_error</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    We are checking if the server is reporting an error</span>
<span class="sd">                2 bytes  2 bytes        string    1 byte</span>
<span class="sd">              ----------------------------------------</span>
<span class="sd">       ERROR | 05    |  ErrorCode |   ErrMsg   |   0  |</span>
<span class="sd">              ----------------------------------------</span>
<span class="sd">    :param data:</span>
<span class="sd">    :return:</span>
<span class="sd">    """</span>
    <span class="n">opcode</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">byteorder</span><span class="o">=</span><span class="s1">'big'</span><span class="p">)</span> <span class="o">==</span> <span class="n">TFTP_OPCODES</span><span class="p">[</span><span class="s1">'error'</span><span class="p">]</span>


<span class="c1"># Map server error codes to messages [ Taken from RFC-1350 ]</span>
<span class="n">server_error_msg</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">0</span><span class="p">:</span> <span class="s2">"Not defined, see error message (if any)."</span><span class="p">,</span>
    <span class="mi">1</span><span class="p">:</span> <span class="s2">"File not found."</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="s2">"Access violation."</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="s2">"Disk full or allocation exceeded."</span><span class="p">,</span>
    <span class="mi">4</span><span class="p">:</span> <span class="s2">"Illegal TFTP operation."</span><span class="p">,</span>
    <span class="mi">5</span><span class="p">:</span> <span class="s2">"Unknown transfer ID."</span><span class="p">,</span>
    <span class="mi">6</span><span class="p">:</span> <span class="s2">"File already exists."</span><span class="p">,</span>
    <span class="mi">7</span><span class="p">:</span> <span class="s2">"No such user."</span>
<span class="p">}</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">arguments</span> <span class="o">=</span> <span class="n">docopt</span><span class="p">(</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">'&lt;filename&gt;'</span><span class="p">]</span>
    <span class="k">print</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">'--mode'</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">'--mode'</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">mode</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">TFTP_MODES</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">"Unknown mode - defaulting to [ netascii ]"</span><span class="p">)</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s2">"netascii"</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s2">"netascii"</span>

    <span class="c1"># Send request</span>
    <span class="k">if</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">'-s'</span><span class="p">]:</span>
        <span class="n">send_rq_struct</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">'-b'</span><span class="p">]:</span>
        <span class="n">send_rq</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">send_rq_struct</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="c1"># Open file locally with the same name as that of the requested file from server</span>
    <span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">"wb"</span><span class="p">)</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="c1"># Wait for the data from the server</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">server</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">recvfrom</span><span class="p">(</span><span class="mi">600</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">server_error</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="n">error_code</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">byteorder</span><span class="o">=</span><span class="s1">'big'</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">server_error_msg</span><span class="p">[</span><span class="n">error_code</span><span class="p">])</span>
            <span class="k">break</span>
        <span class="n">send_ack</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">server</span><span class="p">)</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span>
        <span class="c1"># print(f"Content : {content}")</span>
        <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
        <span class="c1"># print(f"## Data ##: {data[0:4]} : {len(data)}")</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">TERMINATING_DATA_LENGTH</span><span class="p">:</span>
            <span class="k">break</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>Lets look at how the sample run of the program looks like.</p>
<img alt="../../../_images/tftp-final-output.jpg" src="http://127.0.0.1/blog/html/_images/tftp-final-output.jpg"/>
</div>
]]></description>
            <category><![CDATA[ programming ]]></category>
             <pubDate>Wed, 13 Jun 2018 00:00:00 +0530</pubDate>
        </item>
    
        <item>
            <link>http://127.0.0.1/blog/html/2018/06/12/chain_of_responsibility.html</link>
            <guid>http://127.0.0.1/blog/html/2018/06/12/chain_of_responsibility.html</guid>
            <title><![CDATA[Design Pattern : Chain of responsibility [Python]]]></title>
            <description><![CDATA[<h1>Design Pattern : Chain of responsibility [Python]</h1>
<img alt="../../../_images/chain_of_responsibility.png" src="http://127.0.0.1/blog/html/_images/chain_of_responsibility.png"/>
<p>Hello Pythonistas, Lets dive into chain of responsibility pattern.</p>
<p>Its in fact pretty easy to understand. As shown in diagram above. We have chain of handlers , once the event is generated , its
passed to the first handler in chain.</p>
<p>If the handler is able to process the event, the event gets consumed
but if the handler is unable to process the event, handler then passes this event to the next handler in chain.</p>
<div class="section" id="the-bottom-line-is-handlers-should-pass-the-event-that-they-cant-process-to-next-handler-in-chain">
<h2>The bottom line is handlers should pass the event that they cant process, to next handler in chain</h2>
<p>This can be achieved by traditional way using classes for handlers  and making them implement a common process method
but in this post we are going to see how coroutines can be used as handlers and how can we form chain of coroutines.</p>
<p>This recipe is present in book <a class="reference external" href="https://www.amazon.com/Python-Practice-Concurrency-Libraries-Developers/dp/0321905636">Python in Practice</a>. I would highly encourage everyone reading this book.</p>
<p>Before we look at the recipe, lets refresh our knowledge of generators and corotuines in Python.</p>
<ul>
<li><dl class="first docutils">
<dt><strong>Generators:</strong></dt>
<dd><p class="first">Any python function with yield keyword is a generator. Generators are actually producer of items. They not only
produce the item , but they yield control back to the client so that client can process it.</p>
<p>Generators are driven by client : What i mean by that is , unless client asks for the next item , Generators wont produce
the next item. This is significatnly important cause it drastically reduces the memory footprint and avoids unnecessary
processing of the items at the source just to find out later that client is interested in only of subset of it.</p>
<p><strong>To drive the point home, client pulls the item out of generator cause generator is the producer of item upon clients request.</strong></p>
<p class="last">yield item</p>
</dd>
</dl>
</li>
</ul>
<img alt="../../../_images/generator_explanation.png" src="http://127.0.0.1/blog/html/_images/generator_explanation.png"/>
<ul>
<li><dl class="first docutils">
<dt><strong>Coroutines:</strong></dt>
<dd><p class="first">If you look at coroutines , they look pretty similar to generators by the semantics. Yes they have the yield keyword in their
function body. But the way it appears is definitely different, its on the right side of an expression.</p>
<p>item = yield</p>
<p><strong>Fundamental difference when comapred to generators, is that client pushes value into coroutines and it remains suspended till client pushes new value</strong></p>
<p class="last">coro.send(10)</p>
</dd>
</dl>
</li>
</ul>
<img alt="../../../_images/coro_example.png" src="http://127.0.0.1/blog/html/_images/coro_example.png"/>
<p>Now that we have basics of Generators and Coroutines under the belt lets move on to seeing how we can code chain of responsibility
using coroutines.</p>
<p>So to develop an intuition around it, for chain of responsibility we need chain of handlers and we need to be able to <strong>push</strong> event
to first and subsequent handlers based on the current handler was able to process it or not.</p>
<p>So what if our couroutines knew whom to pass the event if they are not able to handle the pushed event, the current coroutine becomes client(pusher) for the next coroutine.</p>
<p>Also if current coroutine is able to handle the pushed item or not, can be any condition; simple or complex and in our example its as simple as string comparison.</p>
<p>Now as show below we have three events and three distinct handlers for that
SongHandler-&gt;ImageHandler-&gt;SlackHandler to handle these events.</p>
<p>every handler takes its successor as an input and thus we are able to make chain.</p>
<div class="highlight-python"><div class="highlight"><pre><span/><span class="n">pipeline</span> <span class="o">=</span> <span class="n">SongHandler</span><span class="p">(</span><span class="n">ImageHandler</span><span class="p">(</span><span class="n">SlackHandler</span><span class="p">()))</span>
</pre></div>
</div>
<p>Now go ahead and give below code a good read and i am sure you will be able to appreciate the beauty of the solution.</p>
<div class="highlight-python"><div class="highlight"><pre><span/><span class="n">In</span> <span class="p">[</span><span class="mi">107</span><span class="p">]:</span> <span class="n">events</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"Downloaded Song"</span><span class="p">,</span> <span class="s2">"Downloaded PNG image"</span><span class="p">,</span> <span class="s2">"Slack notification"</span><span class="p">]</span>

    <span class="n">In</span> <span class="p">[</span><span class="mi">108</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">SongHandler</span><span class="p">(</span><span class="n">successor</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
         <span class="o">...</span><span class="p">:</span>     <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
         <span class="o">...</span><span class="p">:</span>         <span class="n">event</span> <span class="o">=</span> <span class="k">yield</span>
         <span class="o">...</span><span class="p">:</span>         <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="s2">"Downloaded Song"</span><span class="p">:</span>
         <span class="o">...</span><span class="p">:</span>             <span class="k">print</span><span class="p">(</span><span class="s2">"I am handling this song"</span><span class="p">)</span>
         <span class="o">...</span><span class="p">:</span>         <span class="k">else</span><span class="p">:</span>
         <span class="o">...</span><span class="p">:</span>            <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"I cant handle {event}"</span><span class="p">)</span>
         <span class="o">...</span><span class="p">:</span>            <span class="k">if</span> <span class="n">successor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
         <span class="o">...</span><span class="p">:</span>                <span class="n">successor</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
         <span class="o">...</span><span class="p">:</span>            <span class="k">else</span><span class="p">:</span>
         <span class="o">...</span><span class="p">:</span>                <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"Cant handle the {event}"</span><span class="p">)</span>
         <span class="o">...</span><span class="p">:</span>

    <span class="n">In</span> <span class="p">[</span><span class="mi">109</span><span class="p">]:</span> <span class="n">d</span> <span class="o">=</span> <span class="n">SongHandler</span><span class="p">()</span>

    <span class="n">In</span> <span class="p">[</span><span class="mi">110</span><span class="p">]:</span> <span class="n">d</span>
    <span class="n">Out</span><span class="p">[</span><span class="mi">110</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">generator</span> <span class="nb">object</span> <span class="n">SongHandler</span> <span class="n">at</span> <span class="mh">0x105e29830</span><span class="o">&gt;</span>

    <span class="n">In</span> <span class="p">[</span><span class="mi">111</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">getgeneratorstate</span>

    <span class="n">In</span> <span class="p">[</span><span class="mi">112</span><span class="p">]:</span> <span class="n">getgeneratorstate</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="n">Out</span><span class="p">[</span><span class="mi">112</span><span class="p">]:</span> <span class="s1">'GEN_CREATED'</span>

    <span class="n">In</span> <span class="p">[</span><span class="mi">113</span><span class="p">]:</span> <span class="nb">next</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

    <span class="n">In</span> <span class="p">[</span><span class="mi">114</span><span class="p">]:</span> <span class="n">getgeneratorstate</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="n">Out</span><span class="p">[</span><span class="mi">114</span><span class="p">]:</span> <span class="s1">'GEN_SUSPENDED'</span>

    <span class="n">In</span> <span class="p">[</span><span class="mi">115</span><span class="p">]:</span> <span class="n">d</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">"Downloaded PNG image"</span><span class="p">)</span>
    <span class="n">I</span> <span class="n">cant</span> <span class="n">handle</span> <span class="n">Downloaded</span> <span class="n">PNG</span> <span class="n">image</span>
    <span class="n">Cant</span> <span class="n">handle</span> <span class="n">the</span> <span class="n">Downloaded</span> <span class="n">PNG</span> <span class="n">image</span>


    <span class="n">In</span> <span class="p">[</span><span class="mi">116</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">ImageHandler</span><span class="p">(</span><span class="n">successor</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
     <span class="o">...</span><span class="p">:</span>     <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
     <span class="o">...</span><span class="p">:</span>        <span class="n">event</span> <span class="o">=</span> <span class="k">yield</span>
     <span class="o">...</span><span class="p">:</span>        <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="s2">"Downloaded PNG image"</span><span class="p">:</span>
     <span class="o">...</span><span class="p">:</span>           <span class="k">print</span><span class="p">(</span><span class="s2">"I am handling this PNG image"</span><span class="p">)</span>
     <span class="o">...</span><span class="p">:</span>        <span class="k">else</span><span class="p">:</span>
     <span class="o">...</span><span class="p">:</span>           <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"I cant handle event : {event}"</span><span class="p">)</span>
     <span class="o">...</span><span class="p">:</span>           <span class="k">if</span> <span class="n">successor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
     <span class="o">...</span><span class="p">:</span>              <span class="n">successor</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
     <span class="o">...</span><span class="p">:</span>           <span class="k">else</span><span class="p">:</span>
     <span class="o">...</span><span class="p">:</span>              <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"Cant handle the event : {event}"</span><span class="p">)</span>
     <span class="o">...</span><span class="p">:</span>

    <span class="n">In</span> <span class="p">[</span><span class="mi">117</span><span class="p">]:</span>

    <span class="n">In</span> <span class="p">[</span><span class="mi">117</span><span class="p">]:</span> <span class="n">pipeline</span> <span class="o">=</span> <span class="n">SongHandler</span><span class="p">(</span><span class="n">ImageHandler</span><span class="p">())</span>

    <span class="n">In</span> <span class="p">[</span><span class="mi">118</span><span class="p">]:</span> <span class="n">pipeline</span>
    <span class="n">Out</span><span class="p">[</span><span class="mi">118</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">generator</span> <span class="nb">object</span> <span class="n">SongHandler</span> <span class="n">at</span> <span class="mh">0x1065cef68</span><span class="o">&gt;</span>

    <span class="n">In</span> <span class="p">[</span><span class="mi">119</span><span class="p">]:</span> <span class="nb">next</span><span class="p">(</span><span class="n">pipeline</span><span class="p">)</span>

    <span class="n">In</span> <span class="p">[</span><span class="mi">120</span><span class="p">]:</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">"Downloaded PNG image"</span><span class="p">)</span>
    <span class="n">I</span> <span class="n">cant</span> <span class="n">handle</span> <span class="n">Downloaded</span> <span class="n">PNG</span> <span class="n">image</span>


    <span class="o">---------------------------------------------------------------------------</span>
    <span class="ne">TypeError</span>                                 <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">120</span><span class="o">-</span><span class="n">beb994dea500</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span><span class="p">()</span>
    <span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">"Downloaded PNG image"</span><span class="p">)</span>

    <span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">108</span><span class="o">-</span><span class="mi">48988309</span><span class="n">dc83</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="n">SongHandler</span><span class="p">(</span><span class="n">successor</span><span class="p">)</span>
          <span class="mi">7</span>            <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"I cant handle {event}"</span><span class="p">)</span>
          <span class="mi">8</span>            <span class="k">if</span> <span class="n">successor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
    <span class="o">----&gt;</span> <span class="mi">9</span>                <span class="n">successor</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
         <span class="mi">10</span>            <span class="k">else</span><span class="p">:</span>
         <span class="mi">11</span>                <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"Cant handle the {event}"</span><span class="p">)</span>

    <span class="ne">TypeError</span><span class="p">:</span> <span class="n">can</span><span class="s1">'t send non-None value to a just-started generator</span>

    <span class="n">In</span> <span class="p">[</span><span class="mi">121</span><span class="p">]:</span> <span class="c1"># This is where its important to understand the priming of the generator. Now we did prime the SongHandl</span>
          <span class="o">...</span><span class="p">:</span> <span class="n">er</span> <span class="n">by</span> <span class="n">doing</span> <span class="nb">next</span><span class="p">(</span><span class="n">pipeline</span><span class="p">)</span> <span class="n">but</span> <span class="n">SongHandler</span> <span class="n">has</span> <span class="n">Imagehandler</span> <span class="k">as</span> <span class="n">prameter</span> <span class="n">SongHandler</span><span class="p">(</span><span class="n">ImageHandler</span><span class="p">())</span> <span class="n">whic</span>
          <span class="o">...</span><span class="p">:</span> <span class="n">h</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">primed</span><span class="o">.</span>

    <span class="n">In</span> <span class="p">[</span><span class="mi">122</span><span class="p">]:</span> <span class="c1"># Thats the reason why we see this TypeError : can't send non-None value to a just-started generator</span>


    <span class="n">In</span> <span class="p">[</span><span class="mi">123</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>

    <span class="n">In</span> <span class="p">[</span><span class="mi">124</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">coroutine</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
      <span class="o">...</span><span class="p">:</span>     <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
      <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
      <span class="o">...</span><span class="p">:</span>         <span class="n">gen</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
      <span class="o">...</span><span class="p">:</span>         <span class="nb">next</span><span class="p">(</span><span class="n">gen</span><span class="p">)</span>         <span class="c1"># The only thing that it does is moves generator to suspended state from created state to</span>
                                     <span class="c1"># avoid above error</span>
      <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="n">gen</span>
      <span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="n">wrapper</span>
      <span class="o">...</span><span class="p">:</span>
      <span class="o">...</span><span class="p">:</span>

              <span class="nd">@coroutine</span>
      <span class="o">...</span><span class="p">:</span> <span class="k">def</span> <span class="nf">SongHandler</span><span class="p">(</span><span class="n">successor</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
      <span class="o">...</span><span class="p">:</span>       <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
      <span class="o">...</span><span class="p">:</span>           <span class="n">event</span> <span class="o">=</span> <span class="k">yield</span>
      <span class="o">...</span><span class="p">:</span>           <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="s2">"Downloaded Song"</span><span class="p">:</span>
      <span class="o">...</span><span class="p">:</span>               <span class="k">print</span><span class="p">(</span><span class="s2">"[SongHandler] : handling this song"</span><span class="p">)</span>
      <span class="o">...</span><span class="p">:</span>           <span class="k">else</span><span class="p">:</span>
      <span class="o">...</span><span class="p">:</span>              <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"[SongHandler] : cant handle {event}"</span><span class="p">)</span>
      <span class="o">...</span><span class="p">:</span>              <span class="k">if</span> <span class="n">successor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="o">...</span><span class="p">:</span>                  <span class="n">successor</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
      <span class="o">...</span><span class="p">:</span>              <span class="k">else</span>  <span class="p">:</span>
      <span class="o">...</span><span class="p">:</span>                  <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"Cant handle the {event}"</span><span class="p">)</span>
      <span class="o">...</span><span class="p">:</span>
      <span class="o">...</span><span class="p">:</span>
      <span class="o">...</span><span class="p">:</span> <span class="nd">@coroutine</span>
      <span class="o">...</span><span class="p">:</span> <span class="k">def</span> <span class="nf">ImageHandler</span><span class="p">(</span><span class="n">successor</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
      <span class="o">...</span><span class="p">:</span>       <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
      <span class="o">...</span><span class="p">:</span>          <span class="n">event</span> <span class="o">=</span> <span class="k">yield</span>
      <span class="o">...</span><span class="p">:</span>          <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="s2">"Downloaded PNG image"</span><span class="p">:</span>
      <span class="o">...</span><span class="p">:</span>             <span class="k">print</span><span class="p">(</span><span class="s2">"[ImageHandler] : handling this PNG image"</span><span class="p">)</span>
      <span class="o">...</span><span class="p">:</span>          <span class="k">else</span><span class="p">:</span>
      <span class="o">...</span><span class="p">:</span>             <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"[ImageHandler] : cant handle event : {event}"</span><span class="p">)</span>
      <span class="o">...</span><span class="p">:</span>             <span class="k">if</span> <span class="n">successor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="o">...</span><span class="p">:</span>                <span class="n">successor</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
      <span class="o">...</span><span class="p">:</span>             <span class="k">else</span><span class="p">:</span>
      <span class="o">...</span><span class="p">:</span>                <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"[ImageHandler] : No more takers for this event. Getting dropped :-("</span><span class="p">)</span>

                  <span class="nd">@coroutine</span>
      <span class="o">...</span><span class="p">:</span> <span class="k">def</span> <span class="nf">SlackHandler</span><span class="p">(</span><span class="n">successor</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
      <span class="o">...</span><span class="p">:</span>       <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
      <span class="o">...</span><span class="p">:</span>          <span class="n">event</span> <span class="o">=</span> <span class="k">yield</span>
      <span class="o">...</span><span class="p">:</span>          <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="s2">"Slack notification"</span><span class="p">:</span>
      <span class="o">...</span><span class="p">:</span>             <span class="k">print</span><span class="p">(</span><span class="s2">"[ SlackHandler ] : handling this slack notification"</span><span class="p">)</span>
      <span class="o">...</span><span class="p">:</span>          <span class="k">else</span><span class="p">:</span>
      <span class="o">...</span><span class="p">:</span>             <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"[ SlackHandler ] : cant handle event : {event}"</span><span class="p">)</span>
      <span class="o">...</span><span class="p">:</span>             <span class="k">if</span> <span class="n">successor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="o">...</span><span class="p">:</span>                <span class="n">successor</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
      <span class="o">...</span><span class="p">:</span>             <span class="k">else</span><span class="p">:</span>
      <span class="o">...</span><span class="p">:</span>                <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"[ SlackHandler ] No more handlers for this event : {event}. Getting dropped :-("</span><span class="p">)</span>
      <span class="o">...</span><span class="p">:</span>

    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">SongHandler</span><span class="p">(</span><span class="n">ImageHandler</span><span class="p">(</span><span class="n">SlackHandler</span><span class="p">()))</span>

    <span class="n">In</span> <span class="p">[</span><span class="mi">139</span><span class="p">]:</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">"Slack notification"</span><span class="p">)</span>
    <span class="p">[</span><span class="n">SongHandler</span><span class="p">]</span> <span class="p">:</span> <span class="n">cant</span> <span class="n">handle</span> <span class="n">Slack</span> <span class="n">notification</span>
    <span class="p">[</span><span class="n">ImageHandler</span><span class="p">]</span> <span class="p">:</span> <span class="n">cant</span> <span class="n">handle</span> <span class="n">event</span> <span class="p">:</span> <span class="n">Slack</span> <span class="n">notification</span>
    <span class="p">[</span> <span class="n">SlackHandler</span> <span class="p">]</span> <span class="p">:</span> <span class="n">handling</span> <span class="n">this</span> <span class="n">slack</span> <span class="n">notification</span>

    <span class="n">In</span> <span class="p">[</span><span class="mi">140</span><span class="p">]:</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">"Downloaded PNG image"</span><span class="p">)</span>
    <span class="p">[</span><span class="n">SongHandler</span><span class="p">]</span> <span class="p">:</span> <span class="n">cant</span> <span class="n">handle</span> <span class="n">Downloaded</span> <span class="n">PNG</span> <span class="n">image</span>
    <span class="p">[</span><span class="n">ImageHandler</span><span class="p">]</span> <span class="p">:</span> <span class="n">handling</span> <span class="n">this</span> <span class="n">PNG</span> <span class="n">image</span>

    <span class="n">In</span> <span class="p">[</span><span class="mi">141</span><span class="p">]:</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">"Downloaded Song"</span><span class="p">)</span>
    <span class="p">[</span><span class="n">SongHandler</span><span class="p">]</span> <span class="p">:</span> <span class="n">handling</span> <span class="n">this</span> <span class="n">song</span>
</pre></div>
</div>
</div>
]]></description>
            <category><![CDATA[ programming ]]></category>
             <pubDate>Tue, 12 Jun 2018 00:00:00 +0530</pubDate>
        </item>
    
        <item>
            <link>http://127.0.0.1/blog/html/2018/06/11/decorator.html</link>
            <guid>http://127.0.0.1/blog/html/2018/06/11/decorator.html</guid>
            <title><![CDATA[Understanding decorator pattern with Python]]></title>
            <description><![CDATA[<h1>Understanding decorator pattern with Python</h1>
<img alt="../../../_images/hazelnut-cream-hot-chocolate.jpg" src="http://127.0.0.1/blog/html/_images/hazelnut-cream-hot-chocolate.jpg"/>
<p>Hello Pythonistas, Lets implement decorator pattern in Python.
I am a big fan of Head first design patterns book so lets take an example from that book.</p>
<p>When we go to coffee shop like Starbucks or Barista , sometimes
we also like to add toppings to the coffee of our liking, like <strong>whipped cream / ice cream / nutella.</strong></p>
<div class="section" id="what-we-are-essentially-doing-is-we-are-decorating-our-coffee-with-these-extra-toppings-or-condiments">
<h2>What we are essentially doing is we are decorating our coffee with these extra toppings or condiments.</h2>
<p>Now imagine you are the owner of the coffee shop and you wish to determine the price of such item thats decorated
with condiments.</p>
<p>Its safe to say that there is base price associated with coffee and so is with each condiments</p>
<ol class="arabic simple">
<li>Coffee - price 50 [ Base price ]</li>
<li>Whipped Cream - 10</li>
<li>Nutella - 30</li>
</ol>
<ol class="arabic simple">
<li>If you opt for <strong>coffee with whipped cream</strong> - Price will be 60  [ Base price + 10]</li>
<li>If you opt for <strong>coffee with Nutella</strong> - Price will be 80  [ Base price + 30 ]</li>
<li>If you opt for <strong>coffee with Nutella and whipped cream</strong> - Price will be 90 [ Base price + 30 + 10]</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre><span/><span class="n">In</span> <span class="p">[</span><span class="mi">82</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">83</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">whipped_cream</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>     <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>         <span class="n">price</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>         <span class="n">price</span> <span class="o">=</span> <span class="n">price</span> <span class="o">+</span> <span class="mi">10</span>
    <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="n">price</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="n">wrapper</span>
    <span class="o">...</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">84</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">nutella</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>     <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>         <span class="n">price</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>         <span class="n">price</span> <span class="o">=</span> <span class="n">price</span> <span class="o">+</span> <span class="mi">30</span>
    <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="n">price</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="n">wrapper</span>
    <span class="o">...</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">85</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">coffee</span><span class="p">():</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="mi">50</span>
    <span class="o">...</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">86</span><span class="p">]:</span> <span class="nd">@whipped_cream</span>
    <span class="o">...</span><span class="p">:</span> <span class="k">def</span> <span class="nf">coffee_with_whipped_cream</span><span class="p">():</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="n">coffee</span><span class="p">()</span>
    <span class="o">...</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">87</span><span class="p">]:</span> <span class="n">coffee_with_whipped_cream</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">87</span><span class="p">]:</span> <span class="mi">60</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">88</span><span class="p">]:</span> <span class="nd">@whipped_cream</span>
    <span class="o">...</span><span class="p">:</span> <span class="nd">@nutella</span>
    <span class="o">...</span><span class="p">:</span> <span class="k">def</span> <span class="nf">coffee_with_nutella_and_whipped_cream</span><span class="p">():</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="n">coffee</span><span class="p">()</span>
    <span class="o">...</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">89</span><span class="p">]:</span> <span class="n">coffee_with_nutella_and_whipped_cream</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">89</span><span class="p">]:</span> <span class="mi">90</span>
</pre></div>
</div>
</div>
]]></description>
            <category><![CDATA[ programming ]]></category>
             <pubDate>Mon, 11 Jun 2018 00:00:00 +0530</pubDate>
        </item>
    
        <item>
            <link>http://127.0.0.1/blog/html/2018/06/10/hello_world.html</link>
            <guid>http://127.0.0.1/blog/html/2018/06/10/hello_world.html</guid>
            <title><![CDATA[iter function with sentinnel]]></title>
            <description><![CDATA[<h1>iter function with sentinnel</h1>
<p>Hello Pythonistas, did you know that Python iter function has a two arg variant ?</p>
<div class="highlight-python"><div class="highlight"><pre><span/><span class="nb">iter</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">sentinnel</span><span class="p">)</span>
</pre></div>
</div>
<p>However the func - must be a zero argument callable.</p>
<div class="highlight-python"><div class="highlight"><pre><span/><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">sentinnel</span><span class="p">):</span>
    <span class="n">do_something</span><span class="p">()</span>
</pre></div>
</div>
<p>In this case, loop will run only till func produces the sentinnel value.</p>
<dl class="docutils">
<dt><strong>Some use cases :</strong></dt>
<dd><ol class="first last arabic simple">
<li>Run a game loop for specific duration</li>
<li>Read lines from file  till particular match is found</li>
<li>Read data from socket in chunk sizes</li>
</ol>
</dd>
</dl>
<div class="section" id="first-example">
<h2>First Example :</h2>
<div class="highlight-python"><div class="highlight"><pre><span/><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">random</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">genrate_nums</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="c1"># Generate random numbers between 1, 10</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">genrate_nums</span><span class="p">()</span> <span class="c1"># a random number between 1 and 10 is returned.</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="mi">5</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">genrate_nums</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="mi">2</span>
</pre></div>
</div>
<p>Lets look at these two runs. The varying number of iterations in two cases indicate that in the first run the sentinnel
was returned from our <cite>generate_nums</cite> function when it was called 5th time and in the next run the setinnel value was returned when
the <cite>generate_nums</cite> was called for 14th time.</p>
<div class="highlight-python"><div class="highlight"><pre><span/><span class="n">In</span> <span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="n">genrate_nums</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>

<span class="mi">1</span>
<span class="mi">2</span>
<span class="mi">9</span>
<span class="mi">4</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="n">genrate_nums</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>

<span class="mi">4</span>
<span class="mi">10</span>
<span class="mi">9</span>
<span class="mi">3</span>
<span class="mi">2</span>
<span class="mi">8</span>
<span class="mi">1</span>
<span class="mi">9</span>
<span class="mi">3</span>
<span class="mi">7</span>
<span class="mi">8</span>
<span class="mi">3</span>
<span class="mi">2</span>
<span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="section" id="second-example">
<h2>Second Example :</h2>
<p>Lets look at another example where we have a file called ‘hello.txt’
We wish to read lines in file will the line contains “hello”
So effectively we wish to read only first two lines in this files.</p>
<p>Lets see how we can go about achieving the same.</p>
<div class="highlight-python"><div class="highlight"><pre><span/><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">cat</span> <span class="s1">'hello.txt'</span>
<span class="n">sdfasd</span>
<span class="n">sdfdfdf</span>
<span class="n">hello</span>
<span class="n">sdfasd</span>
<span class="n">asdfasd</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'hello.txt'</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="nb">file</span><span class="o">.</span><span class="n">readline</span><span class="p">,</span> <span class="s2">"hello</span><span class="se">\n</span><span class="s2">"</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>         <span class="k">print</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">''</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>
<span class="n">sdfasd</span>
<span class="n">sdfdfdf</span>
</pre></div>
</div>
</div>
]]></description>
            <category><![CDATA[ trick ]]></category>
             <pubDate>Sun, 10 Jun 2018 00:00:00 +0530</pubDate>
        </item>
    
    </channel>
</rss>