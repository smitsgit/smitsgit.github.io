<!DOCTYPE html><!--[if lt IE 7]>      <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="description" content="Useful python resources and helpful explanations on quirks of the language">
        <meta name="viewport" content="width=device-width">
        <title>Home &mdash; Pythonista</title>
            <link rel="stylesheet" href="_static/normalize.css" type="text/css">
            <link rel="stylesheet" href="_static/sphinx.css" type="text/css">
            <link rel="stylesheet" href="_static/main.css" type="text/css">
            <link rel="stylesheet" href="_static/flat.css" type="text/css">
            <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
            <link rel="stylesheet" href="_static/font-awesome.min.css" type="text/css">
        <link rel="shortcut icon" href="_static/tinkerer.ico" /><!-- Load modernizr and JQuery -->
        <script src="_static/vendor/modernizr-2.6.2.min.js"></script>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="_static/vendor/jquery-1.8.2.min.js"><\/script>')</script>
        <script src="_static/plugins.js"></script>
        <script src="_static/main.js"></script>
        <link rel="search" title="Search" href="search.html" /><link rel="alternate" type="application/rss+xml" title="RSS" href="rss.html" /><script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.6.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        SOURCELINK_SUFFIX: '.txt',
        HAS_SOURCE:  true
      };
    </script><script type="text/javascript" src="_static/underscore.js"></script><script type="text/javascript" src="_static/doctools.js"></script><script type="text/javascript" src="_static/disqus.js"></script><script type="text/javascript" src="_static/google_analytics.js"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            // Scroll to content if on small screen
            if (screen.width < 480)
            {
                $(document).scrollTop(document.getElementsByTagName("article")[0].offsetTop - 44);
            }
        });
    </script></head>
    <body role="document">
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

      <div id="container"><header role="banner">
            <hgroup>
              <h1><a href="#">Pythonista</a></h1><h2>Blogging for Pythonistas</h2></hgroup>
          </header>
      <nav role="navigation">
            <ul><li class="main-nav">
                  <a href="#">Home</a>
                </li>
              <li class="main-nav">
                  <a href="pages/about.html">Videos</a>
                </li>
              </ul>
          </nav><div class="main-container" role="main"><div class="main wrapper body clearfix"><article><div class="timestamp postmeta">
            <span>June 12, 2018</span>
        </div>
        <div class="section">
            <h1><a href="2018/06/12/chain_of_responsibility.html">Design Pattern : Chain of responsibility [Python]</a></h1>
<img alt="../../../_images/chain_of_responsibility.png" src="_images/chain_of_responsibility.png"/>
<p>Hello Pythonistas, Lets dive into chain of responsibility pattern.</p>
<p>Its in fact pretty easy to understand. As shown in diagram above. We have chain of handlers , once the event is generated , its
passed to the first handler in chain.</p>
<p>If the handler is able to process the event, the event gets consumed
but if the handler is unable to process the event, handler then passes this event to the next handler in chain.</p>
<div class="section" id="the-bottom-line-is-handlers-should-pass-the-event-that-they-cant-process-to-next-handler-in-chain">
<h2>The bottom line is handlers should pass the event that they cant process, to next handler in chain</h2>
<p>This can be achieved by traditional way using classes for handlers  and making them implement a common process method
but in this post we are going to see how coroutines can be used as handlers and how can we form chain of coroutines.</p>
<p>This recipe is present in book <a class="reference external" href="https://www.amazon.com/Python-Practice-Concurrency-Libraries-Developers/dp/0321905636">Python in Practice</a>. I would highly encourage everyone reading this book.</p>
<p>Before we look at the recipe, lets refresh our knowledge of generators and corotuines in Python.</p>
<ul>
<li><dl class="first docutils">
<dt><strong>Generators:</strong></dt>
<dd><p class="first">Any python function with yield keyword is a generator. Generators are actually producer of items. They not only
produce the item , but they yield control back to the client so that client can process it.</p>
<p>Generators are driven by client : What i mean by that is , unless client asks for the next item , Generators wont produce
the next item. This is significatnly important cause it drastically reduces the memory footprint and avoids unnecessary
processing of the items at the source just to find out later that client is interested in only of subset of it.</p>
<p><strong>To drive the point home, client pulls the item out of generator cause generator is the producer of item upon clients request.</strong></p>
<p class="last">yield item</p>
</dd>
</dl>
</li>
</ul>
<img alt="../../../_images/generator_explanation.png" src="_images/generator_explanation.png"/>
<ul>
<li><dl class="first docutils">
<dt><strong>Coroutines:</strong></dt>
<dd><p class="first">If you look at coroutines , they look pretty similar to generators by the semantics. Yes they have the yield keyword in their
function body. But the way it appears is definitely different, its on the right side of an expression.</p>
<p>item = yield</p>
<p><strong>Fundamental difference when comapred to generators, is that client pushes value into coroutines and it remains suspended till client pushes new value</strong></p>
<p class="last">coro.send(10)</p>
</dd>
</dl>
</li>
</ul>
<img alt="../../../_images/coro_example.png" src="_images/coro_example.png"/>
<p>Now that we have basics of Generators and Coroutines under the belt lets move on to seeing how we can code chain of responsibility
using coroutines.</p>
<p>So to develop an intuition around it, for chain of responsibility we need chain of handlers and we need to be able to <strong>push</strong> event
to first and subsequent handlers based on the current handler was able to process it or not.</p>
<p>So what if our couroutines knew whom to pass the event if they are not able to handle the pushed event, the current coroutine becomes client(pusher) for the next coroutine.</p>
<p>Also if current coroutine is able to handle the pushed item or not, can be any condition; simple or complex and in our example its as simple as string comparison.</p>
<p>Now as show below we have three events and three distinct handlers for that
SongHandler-&gt;ImageHandler-&gt;SlackHandler to handle these events.</p>
<p>every handler takes its successor as an input and thus we are able to make chain.</p>
<div class="highlight-python"><div class="highlight"><pre><span/><span class="n">pipeline</span> <span class="o">=</span> <span class="n">SongHandler</span><span class="p">(</span><span class="n">ImageHandler</span><span class="p">(</span><span class="n">SlackHandler</span><span class="p">()))</span>
</pre></div>
</div>
<p>Now go ahead and give below code a good read and i am sure you will be able to appreciate the beauty of the solution.</p>
<div class="highlight-python"><div class="highlight"><pre><span/><span class="n">In</span> <span class="p">[</span><span class="mi">107</span><span class="p">]:</span> <span class="n">events</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"Downloaded Song"</span><span class="p">,</span> <span class="s2">"Downloaded PNG image"</span><span class="p">,</span> <span class="s2">"Slack notification"</span><span class="p">]</span>

    <span class="n">In</span> <span class="p">[</span><span class="mi">108</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">SongHandler</span><span class="p">(</span><span class="n">successor</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
         <span class="o">...</span><span class="p">:</span>     <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
         <span class="o">...</span><span class="p">:</span>         <span class="n">event</span> <span class="o">=</span> <span class="k">yield</span>
         <span class="o">...</span><span class="p">:</span>         <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="s2">"Downloaded Song"</span><span class="p">:</span>
         <span class="o">...</span><span class="p">:</span>             <span class="k">print</span><span class="p">(</span><span class="s2">"I am handling this song"</span><span class="p">)</span>
         <span class="o">...</span><span class="p">:</span>         <span class="k">else</span><span class="p">:</span>
         <span class="o">...</span><span class="p">:</span>            <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"I cant handle {event}"</span><span class="p">)</span>
         <span class="o">...</span><span class="p">:</span>            <span class="k">if</span> <span class="n">successor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
         <span class="o">...</span><span class="p">:</span>                <span class="n">successor</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
         <span class="o">...</span><span class="p">:</span>            <span class="k">else</span><span class="p">:</span>
         <span class="o">...</span><span class="p">:</span>                <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"Cant handle the {event}"</span><span class="p">)</span>
         <span class="o">...</span><span class="p">:</span>

    <span class="n">In</span> <span class="p">[</span><span class="mi">109</span><span class="p">]:</span> <span class="n">d</span> <span class="o">=</span> <span class="n">SongHandler</span><span class="p">()</span>

    <span class="n">In</span> <span class="p">[</span><span class="mi">110</span><span class="p">]:</span> <span class="n">d</span>
    <span class="n">Out</span><span class="p">[</span><span class="mi">110</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">generator</span> <span class="nb">object</span> <span class="n">SongHandler</span> <span class="n">at</span> <span class="mh">0x105e29830</span><span class="o">&gt;</span>

    <span class="n">In</span> <span class="p">[</span><span class="mi">111</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">getgeneratorstate</span>

    <span class="n">In</span> <span class="p">[</span><span class="mi">112</span><span class="p">]:</span> <span class="n">getgeneratorstate</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="n">Out</span><span class="p">[</span><span class="mi">112</span><span class="p">]:</span> <span class="s1">'GEN_CREATED'</span>

    <span class="n">In</span> <span class="p">[</span><span class="mi">113</span><span class="p">]:</span> <span class="nb">next</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

    <span class="n">In</span> <span class="p">[</span><span class="mi">114</span><span class="p">]:</span> <span class="n">getgeneratorstate</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="n">Out</span><span class="p">[</span><span class="mi">114</span><span class="p">]:</span> <span class="s1">'GEN_SUSPENDED'</span>

    <span class="n">In</span> <span class="p">[</span><span class="mi">115</span><span class="p">]:</span> <span class="n">d</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">"Downloaded PNG image"</span><span class="p">)</span>
    <span class="n">I</span> <span class="n">cant</span> <span class="n">handle</span> <span class="n">Downloaded</span> <span class="n">PNG</span> <span class="n">image</span>
    <span class="n">Cant</span> <span class="n">handle</span> <span class="n">the</span> <span class="n">Downloaded</span> <span class="n">PNG</span> <span class="n">image</span>


    <span class="n">In</span> <span class="p">[</span><span class="mi">116</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">ImageHandler</span><span class="p">(</span><span class="n">successor</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
     <span class="o">...</span><span class="p">:</span>     <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
     <span class="o">...</span><span class="p">:</span>        <span class="n">event</span> <span class="o">=</span> <span class="k">yield</span>
     <span class="o">...</span><span class="p">:</span>        <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="s2">"Downloaded PNG image"</span><span class="p">:</span>
     <span class="o">...</span><span class="p">:</span>           <span class="k">print</span><span class="p">(</span><span class="s2">"I am handling this PNG image"</span><span class="p">)</span>
     <span class="o">...</span><span class="p">:</span>        <span class="k">else</span><span class="p">:</span>
     <span class="o">...</span><span class="p">:</span>           <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"I cant handle event : {event}"</span><span class="p">)</span>
     <span class="o">...</span><span class="p">:</span>           <span class="k">if</span> <span class="n">successor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
     <span class="o">...</span><span class="p">:</span>              <span class="n">successor</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
     <span class="o">...</span><span class="p">:</span>           <span class="k">else</span><span class="p">:</span>
     <span class="o">...</span><span class="p">:</span>              <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"Cant handle the event : {event}"</span><span class="p">)</span>
     <span class="o">...</span><span class="p">:</span>

    <span class="n">In</span> <span class="p">[</span><span class="mi">117</span><span class="p">]:</span>

    <span class="n">In</span> <span class="p">[</span><span class="mi">117</span><span class="p">]:</span> <span class="n">pipeline</span> <span class="o">=</span> <span class="n">SongHandler</span><span class="p">(</span><span class="n">ImageHandler</span><span class="p">())</span>

    <span class="n">In</span> <span class="p">[</span><span class="mi">118</span><span class="p">]:</span> <span class="n">pipeline</span>
    <span class="n">Out</span><span class="p">[</span><span class="mi">118</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">generator</span> <span class="nb">object</span> <span class="n">SongHandler</span> <span class="n">at</span> <span class="mh">0x1065cef68</span><span class="o">&gt;</span>

    <span class="n">In</span> <span class="p">[</span><span class="mi">119</span><span class="p">]:</span> <span class="nb">next</span><span class="p">(</span><span class="n">pipeline</span><span class="p">)</span>

    <span class="n">In</span> <span class="p">[</span><span class="mi">120</span><span class="p">]:</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">"Downloaded PNG image"</span><span class="p">)</span>
    <span class="n">I</span> <span class="n">cant</span> <span class="n">handle</span> <span class="n">Downloaded</span> <span class="n">PNG</span> <span class="n">image</span>


    <span class="o">---------------------------------------------------------------------------</span>
    <span class="ne">TypeError</span>                                 <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">120</span><span class="o">-</span><span class="n">beb994dea500</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span><span class="p">()</span>
    <span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">"Downloaded PNG image"</span><span class="p">)</span>

    <span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">108</span><span class="o">-</span><span class="mi">48988309</span><span class="n">dc83</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="n">SongHandler</span><span class="p">(</span><span class="n">successor</span><span class="p">)</span>
          <span class="mi">7</span>            <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"I cant handle {event}"</span><span class="p">)</span>
          <span class="mi">8</span>            <span class="k">if</span> <span class="n">successor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
    <span class="o">----&gt;</span> <span class="mi">9</span>                <span class="n">successor</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
         <span class="mi">10</span>            <span class="k">else</span><span class="p">:</span>
         <span class="mi">11</span>                <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"Cant handle the {event}"</span><span class="p">)</span>

    <span class="ne">TypeError</span><span class="p">:</span> <span class="n">can</span><span class="s1">'t send non-None value to a just-started generator</span>

    <span class="n">In</span> <span class="p">[</span><span class="mi">121</span><span class="p">]:</span> <span class="c1"># This is where its important to understand the priming of the generator. Now we did prime the SongHandl</span>
          <span class="o">...</span><span class="p">:</span> <span class="n">er</span> <span class="n">by</span> <span class="n">doing</span> <span class="nb">next</span><span class="p">(</span><span class="n">pipeline</span><span class="p">)</span> <span class="n">but</span> <span class="n">SongHandler</span> <span class="n">has</span> <span class="n">Imagehandler</span> <span class="k">as</span> <span class="n">prameter</span> <span class="n">SongHandler</span><span class="p">(</span><span class="n">ImageHandler</span><span class="p">())</span> <span class="n">whic</span>
          <span class="o">...</span><span class="p">:</span> <span class="n">h</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">primed</span><span class="o">.</span>

    <span class="n">In</span> <span class="p">[</span><span class="mi">122</span><span class="p">]:</span> <span class="c1"># Thats the reason why we see this TypeError : can't send non-None value to a just-started generator</span>


    <span class="n">In</span> <span class="p">[</span><span class="mi">123</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>

    <span class="n">In</span> <span class="p">[</span><span class="mi">124</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">coroutine</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
      <span class="o">...</span><span class="p">:</span>     <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
      <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
      <span class="o">...</span><span class="p">:</span>         <span class="n">gen</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
      <span class="o">...</span><span class="p">:</span>         <span class="nb">next</span><span class="p">(</span><span class="n">gen</span><span class="p">)</span>         <span class="c1"># The only thing that it does is moves generator to suspended state from created state to</span>
                                     <span class="c1"># avoid above error</span>
      <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="n">gen</span>
      <span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="n">wrapper</span>
      <span class="o">...</span><span class="p">:</span>
      <span class="o">...</span><span class="p">:</span>

              <span class="nd">@coroutine</span>
      <span class="o">...</span><span class="p">:</span> <span class="k">def</span> <span class="nf">SongHandler</span><span class="p">(</span><span class="n">successor</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
      <span class="o">...</span><span class="p">:</span>       <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
      <span class="o">...</span><span class="p">:</span>           <span class="n">event</span> <span class="o">=</span> <span class="k">yield</span>
      <span class="o">...</span><span class="p">:</span>           <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="s2">"Downloaded Song"</span><span class="p">:</span>
      <span class="o">...</span><span class="p">:</span>               <span class="k">print</span><span class="p">(</span><span class="s2">"[SongHandler] : handling this song"</span><span class="p">)</span>
      <span class="o">...</span><span class="p">:</span>           <span class="k">else</span><span class="p">:</span>
      <span class="o">...</span><span class="p">:</span>              <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"[SongHandler] : cant handle {event}"</span><span class="p">)</span>
      <span class="o">...</span><span class="p">:</span>              <span class="k">if</span> <span class="n">successor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="o">...</span><span class="p">:</span>                  <span class="n">successor</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
      <span class="o">...</span><span class="p">:</span>              <span class="k">else</span>  <span class="p">:</span>
      <span class="o">...</span><span class="p">:</span>                  <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"Cant handle the {event}"</span><span class="p">)</span>
      <span class="o">...</span><span class="p">:</span>
      <span class="o">...</span><span class="p">:</span>
      <span class="o">...</span><span class="p">:</span> <span class="nd">@coroutine</span>
      <span class="o">...</span><span class="p">:</span> <span class="k">def</span> <span class="nf">ImageHandler</span><span class="p">(</span><span class="n">successor</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
      <span class="o">...</span><span class="p">:</span>       <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
      <span class="o">...</span><span class="p">:</span>          <span class="n">event</span> <span class="o">=</span> <span class="k">yield</span>
      <span class="o">...</span><span class="p">:</span>          <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="s2">"Downloaded PNG image"</span><span class="p">:</span>
      <span class="o">...</span><span class="p">:</span>             <span class="k">print</span><span class="p">(</span><span class="s2">"[ImageHandler] : handling this PNG image"</span><span class="p">)</span>
      <span class="o">...</span><span class="p">:</span>          <span class="k">else</span><span class="p">:</span>
      <span class="o">...</span><span class="p">:</span>             <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"[ImageHandler] : cant handle event : {event}"</span><span class="p">)</span>
      <span class="o">...</span><span class="p">:</span>             <span class="k">if</span> <span class="n">successor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="o">...</span><span class="p">:</span>                <span class="n">successor</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
      <span class="o">...</span><span class="p">:</span>             <span class="k">else</span><span class="p">:</span>
      <span class="o">...</span><span class="p">:</span>                <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"[ImageHandler] : No more takers for this event. Getting dropped :-("</span><span class="p">)</span>

                  <span class="nd">@coroutine</span>
      <span class="o">...</span><span class="p">:</span> <span class="k">def</span> <span class="nf">SlackHandler</span><span class="p">(</span><span class="n">successor</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
      <span class="o">...</span><span class="p">:</span>       <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
      <span class="o">...</span><span class="p">:</span>          <span class="n">event</span> <span class="o">=</span> <span class="k">yield</span>
      <span class="o">...</span><span class="p">:</span>          <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="s2">"Slack notification"</span><span class="p">:</span>
      <span class="o">...</span><span class="p">:</span>             <span class="k">print</span><span class="p">(</span><span class="s2">"[ SlackHandler ] : handling this slack notification"</span><span class="p">)</span>
      <span class="o">...</span><span class="p">:</span>          <span class="k">else</span><span class="p">:</span>
      <span class="o">...</span><span class="p">:</span>             <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"[ SlackHandler ] : cant handle event : {event}"</span><span class="p">)</span>
      <span class="o">...</span><span class="p">:</span>             <span class="k">if</span> <span class="n">successor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="o">...</span><span class="p">:</span>                <span class="n">successor</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
      <span class="o">...</span><span class="p">:</span>             <span class="k">else</span><span class="p">:</span>
      <span class="o">...</span><span class="p">:</span>                <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"[ SlackHandler ] No more handlers for this event : {event}. Getting dropped :-("</span><span class="p">)</span>
      <span class="o">...</span><span class="p">:</span>

    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">SongHandler</span><span class="p">(</span><span class="n">ImageHandler</span><span class="p">(</span><span class="n">SlackHandler</span><span class="p">()))</span>

    <span class="n">In</span> <span class="p">[</span><span class="mi">139</span><span class="p">]:</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">"Slack notification"</span><span class="p">)</span>
    <span class="p">[</span><span class="n">SongHandler</span><span class="p">]</span> <span class="p">:</span> <span class="n">cant</span> <span class="n">handle</span> <span class="n">Slack</span> <span class="n">notification</span>
    <span class="p">[</span><span class="n">ImageHandler</span><span class="p">]</span> <span class="p">:</span> <span class="n">cant</span> <span class="n">handle</span> <span class="n">event</span> <span class="p">:</span> <span class="n">Slack</span> <span class="n">notification</span>
    <span class="p">[</span> <span class="n">SlackHandler</span> <span class="p">]</span> <span class="p">:</span> <span class="n">handling</span> <span class="n">this</span> <span class="n">slack</span> <span class="n">notification</span>

    <span class="n">In</span> <span class="p">[</span><span class="mi">140</span><span class="p">]:</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">"Downloaded PNG image"</span><span class="p">)</span>
    <span class="p">[</span><span class="n">SongHandler</span><span class="p">]</span> <span class="p">:</span> <span class="n">cant</span> <span class="n">handle</span> <span class="n">Downloaded</span> <span class="n">PNG</span> <span class="n">image</span>
    <span class="p">[</span><span class="n">ImageHandler</span><span class="p">]</span> <span class="p">:</span> <span class="n">handling</span> <span class="n">this</span> <span class="n">PNG</span> <span class="n">image</span>

    <span class="n">In</span> <span class="p">[</span><span class="mi">141</span><span class="p">]:</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">"Downloaded Song"</span><span class="p">)</span>
    <span class="p">[</span><span class="n">SongHandler</span><span class="p">]</span> <span class="p">:</span> <span class="n">handling</span> <span class="n">this</span> <span class="n">song</span>
</pre></div>
</div>
</div>

        </div>
        <div class="postmeta">
        <div class="author">
            <span>Posted by Smital Desai</span>
        </div>
        <div class="categories">
            <span>
                Filed under:
                <a href="categories/programming.html">programming</a></span>
        </div>
        <div class="tags">
            <span>
                Tags:
                <a href="tags/pattern.html">pattern</a></span>
        </div>
        </div><div class="separator post_separator"></div><div class="timestamp postmeta">
            <span>June 11, 2018</span>
        </div>
        <div class="section">
            <h1><a href="2018/06/11/decorator.html">Understanding decorator pattern with Python</a></h1>
<img alt="../../../_images/hazelnut-cream-hot-chocolate.jpg" src="_images/hazelnut-cream-hot-chocolate.jpg"/>
<p>Hello Pythonistas, Lets implement decorator pattern in Python.
I am a big fan of Head first design patterns book so lets take an example from that book.</p>
<p>When we go to coffee shop like Starbucks or Barista , sometimes
we also like to add toppings to the coffee of our liking, like <strong>whipped cream / ice cream / nutella.</strong></p>
<div class="section" id="what-we-are-essentially-doing-is-we-are-decorating-our-coffee-with-these-extra-toppings-or-condiments">
<h2>What we are essentially doing is we are decorating our coffee with these extra toppings or condiments.</h2>
<p>Now imagine you are the owner of the coffee shop and you wish to determine the price of such item thats decorated
with condiments.</p>
<p>Its safe to say that there is base price associated with coffee and so is with each condiments</p>
<ol class="arabic simple">
<li>Coffee - price 50 [ Base price ]</li>
<li>Whipped Cream - 10</li>
<li>Nutella - 30</li>
</ol>
<ol class="arabic simple">
<li>If you opt for <strong>coffee with whipped cream</strong> - Price will be 60  [ Base price + 10]</li>
<li>If you opt for <strong>coffee with Nutella</strong> - Price will be 80  [ Base price + 30 ]</li>
<li>If you opt for <strong>coffee with Nutella and whipped cream</strong> - Price will be 90 [ Base price + 30 + 10]</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre><span/><span class="n">In</span> <span class="p">[</span><span class="mi">82</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">83</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">whipped_cream</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>     <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>         <span class="n">price</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>         <span class="n">price</span> <span class="o">=</span> <span class="n">price</span> <span class="o">+</span> <span class="mi">10</span>
    <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="n">price</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="n">wrapper</span>
    <span class="o">...</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">84</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">nutella</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>     <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>         <span class="n">price</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>         <span class="n">price</span> <span class="o">=</span> <span class="n">price</span> <span class="o">+</span> <span class="mi">30</span>
    <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="n">price</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="n">wrapper</span>
    <span class="o">...</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">85</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">coffee</span><span class="p">():</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="mi">50</span>
    <span class="o">...</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">86</span><span class="p">]:</span> <span class="nd">@whipped_cream</span>
    <span class="o">...</span><span class="p">:</span> <span class="k">def</span> <span class="nf">coffee_with_whipped_cream</span><span class="p">():</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="n">coffee</span><span class="p">()</span>
    <span class="o">...</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">87</span><span class="p">]:</span> <span class="n">coffee_with_whipped_cream</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">87</span><span class="p">]:</span> <span class="mi">60</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">88</span><span class="p">]:</span> <span class="nd">@whipped_cream</span>
    <span class="o">...</span><span class="p">:</span> <span class="nd">@nutella</span>
    <span class="o">...</span><span class="p">:</span> <span class="k">def</span> <span class="nf">coffee_with_nutella_and_whipped_cream</span><span class="p">():</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="n">coffee</span><span class="p">()</span>
    <span class="o">...</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">89</span><span class="p">]:</span> <span class="n">coffee_with_nutella_and_whipped_cream</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">89</span><span class="p">]:</span> <span class="mi">90</span>
</pre></div>
</div>
</div>

        </div>
        <div class="postmeta">
        <div class="author">
            <span>Posted by Smital Desai</span>
        </div>
        <div class="categories">
            <span>
                Filed under:
                <a href="categories/programming.html">programming</a></span>
        </div>
        <div class="tags">
            <span>
                Tags:
                <a href="tags/pattern.html">pattern</a></span>
        </div>
        </div><div class="separator post_separator"></div><div class="timestamp postmeta">
            <span>June 10, 2018</span>
        </div>
        <div class="section">
            <h1><a href="2018/06/10/hello_world.html">iter function with sentinnel</a></h1>
<p>Hello Pythonistas, did you know that Python iter function has a two arg variant ?</p>
<div class="highlight-python"><div class="highlight"><pre><span/><span class="nb">iter</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">sentinnel</span><span class="p">)</span>
</pre></div>
</div>
<p>However the func - must be a zero argument callable.</p>
<div class="highlight-python"><div class="highlight"><pre><span/><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">sentinnel</span><span class="p">):</span>
    <span class="n">do_something</span><span class="p">()</span>
</pre></div>
</div>
<p>In this case, loop will run only till func produces the sentinnel value.</p>
<dl class="docutils">
<dt><strong>Some use cases :</strong></dt>
<dd><ol class="first last arabic simple">
<li>Run a game loop for specific duration</li>
<li>Read lines from file  till particular match is found</li>
<li>Read data from socket in chunk sizes</li>
</ol>
</dd>
</dl>
<div class="section" id="first-example">
<h2>First Example :</h2>
<div class="highlight-python"><div class="highlight"><pre><span/><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">random</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">genrate_nums</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="c1"># Generate random numbers between 1, 10</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">genrate_nums</span><span class="p">()</span> <span class="c1"># a random number between 1 and 10 is returned.</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="mi">5</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">genrate_nums</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="mi">2</span>
</pre></div>
</div>
<p>Lets look at these two runs. The varying number of iterations in two cases indicate that in the first run the sentinnel
was returned from our <cite>generate_nums</cite> function when it was called 5th time and in the next run the setinnel value was returned when
the <cite>generate_nums</cite> was called for 14th time.</p>
<div class="highlight-python"><div class="highlight"><pre><span/><span class="n">In</span> <span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="n">genrate_nums</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>

<span class="mi">1</span>
<span class="mi">2</span>
<span class="mi">9</span>
<span class="mi">4</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="n">genrate_nums</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>

<span class="mi">4</span>
<span class="mi">10</span>
<span class="mi">9</span>
<span class="mi">3</span>
<span class="mi">2</span>
<span class="mi">8</span>
<span class="mi">1</span>
<span class="mi">9</span>
<span class="mi">3</span>
<span class="mi">7</span>
<span class="mi">8</span>
<span class="mi">3</span>
<span class="mi">2</span>
<span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="section" id="second-example">
<h2>Second Example :</h2>
<p>Lets look at another example where we have a file called ‘hello.txt’
We wish to read lines in file will the line contains “hello”
So effectively we wish to read only first two lines in this files.</p>
<p>Lets see how we can go about achieving the same.</p>
<div class="highlight-python"><div class="highlight"><pre><span/><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">cat</span> <span class="s1">'hello.txt'</span>
<span class="n">sdfasd</span>
<span class="n">sdfdfdf</span>
<span class="n">hello</span>
<span class="n">sdfasd</span>
<span class="n">asdfasd</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'hello.txt'</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="nb">file</span><span class="o">.</span><span class="n">readline</span><span class="p">,</span> <span class="s2">"hello</span><span class="se">\n</span><span class="s2">"</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>         <span class="k">print</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">''</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>
<span class="n">sdfasd</span>
<span class="n">sdfdfdf</span>
</pre></div>
</div>
</div>

        </div>
        <div class="postmeta">
        <div class="author">
            <span>Posted by Smital Desai</span>
        </div>
        <div class="categories">
            <span>
                Filed under:
                <a href="categories/trick.html">trick</a></span>
        </div>
        <div class="tags">
            <span>
                Tags:
                <a href="tags/iter.html">iter</a></span>
        </div>
        </div><div class="archive_link">
        <a href="archive.html"> &mdash; Blog Archive &mdash; </a>
    </div></article><aside class="sidebar"><section><div class="widget">
    <h1>Recent Posts</h1>
    <ul><li>
            <a href="2018/06/12/chain_of_responsibility.html">Design Pattern : Chain of responsibility [Python]</a>
        </li><li>
            <a href="2018/06/11/decorator.html">Understanding decorator pattern with Python</a>
        </li><li>
            <a href="2018/06/10/hello_world.html">iter function with sentinnel</a>
        </li></ul>
</div>
</section><section><div class="widget" id="searchbox" role="search">
    <h1><a href="#searchbox">Search</a></h1>
    <form action="search.html" method="get">
        <input type="text" name="q" />
        <button type="submit"><span class="fa fa-search"></span></button>
    </form>
</div></section></aside></div> <!-- #main --></div> <!-- #main-container -->

        <div class="footer-container" role="contentinfo"><footer class="wrapper">&copy; Copyright 2018, Smital Desai. Powered by <a href="http://www.tinkerer.me/">Tinkerer</a> and <a href="http://sphinx.pocoo.org/">Sphinx</a>.</footer></div> <!-- footer-container -->

      </div> <!--! end of #container --><script type="text/javascript">    var disqus_shortname = "Smital";    disqus_count();</script><!--[if lt IE 7 ]>
          <script src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min.js"></script>
          <script>window.attachEvent('onload',function(){CFInstall.check({mode:'overlay'})})</script>
        <![endif]-->
    </body>
</html>